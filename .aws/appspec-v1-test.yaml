version: 0.0

Resources:
  - TargetService:
      Type: AWS::ECS::Service
      Properties:
        TaskDefinition: <TASK_DEFINITION>
        LoadBalancerInfo:
          ContainerName: "fastapi-bootstrap-v1"
          ContainerPort: 8000
        PlatformVersion: "LATEST"
        NetworkConfiguration:
          AwsvpcConfiguration:
            Subnets: ["<SUBNET_1>", "<SUBNET_2>"]
            SecurityGroups: ["<SECURITY_GROUP>"]
            AssignPublicIp: "DISABLED"

Hooks:
  - BeforeInstall: "${lambda_validate_before_install_arn}"
  - AfterInstall: "${lambda_validate_deployment_arn}"
  - AfterAllowTestTraffic: "${lambda_validate_test_traffic_arn}"
  - BeforeAllowTraffic: "${lambda_run_migrations_arn}"
  - AfterAllowTraffic: "${lambda_validate_production_arn}"
